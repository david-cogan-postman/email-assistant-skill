---
phase: 02-robust-handling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [SKILL.md]
autonomous: true

must_haves:
  truths:
    - "Skill activates when user clearly indicates intent (flexible phrasing, not exact keywords)"
    - "Skill asks for confirmation when invocation is ambiguous"
    - "Skill suggests drafting email when transcript pasted without explicit request"
    - "Skill always generates draft immediately, never blocks on clarifying questions"
    - "Skill asks recipient name if unclear, but still provides draft with placeholder"
  artifacts:
    - path: "SKILL.md"
      provides: "Enhanced skill with activation detection and clarification protocol"
      contains: "<activation_detection>"
  key_links:
    - from: "SKILL.md activation_detection"
      to: "SKILL.md extraction"
      via: "Decision tree determines proceed vs ask vs suggest"
      pattern: "IF invocation is CLEAR"
---

<objective>
Add flexible activation detection and ask-then-generate clarification protocol to SKILL.md

Purpose: Make the skill reliably activate on intent (not exact keywords) and handle incomplete information gracefully by always generating a draft while asking clarifying questions additively.

Output: Enhanced SKILL.md with activation_detection and clarification_protocol XML sections
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-robust-handling/02-CONTEXT.md
@.planning/phases/02-robust-handling/02-RESEARCH.md
@SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add activation detection and clarification protocol to SKILL.md</name>
  <files>SKILL.md</files>
  <action>
Enhance SKILL.md by adding two new XML-structured sections after the frontmatter and before "## Your Task":

1. **Add `<activation_detection>` section** with three-tier decision logic:
   - CLEAR invocation (proceed immediately): User mentions "skill", "follow-up", "draft email", or similar + provides transcript
   - AMBIGUOUS invocation (ask for confirmation): User says "help me with this call" or similar without explicit email request
   - NO invocation (suggest usage): User pastes transcript without any request

   Include concrete examples for each tier. Key phrases per CONTEXT.md:
   - Clear: "Generate a follow-up email", "Draft an email", "Use the skill"
   - Ambiguous: "What should I do with this?", "Help me with this call"
   - None: Just pasting transcript

   Add decision responses:
   - Ambiguous: "Did you want me to generate a follow-up email?"
   - None: "Would you like me to draft a follow-up email from this transcript?"

2. **Add `<clarification_protocol>` section** with ask-then-generate pattern:
   - CRITICAL RULE: Always generate draft immediately, questions are ADDITIVE not BLOCKING
   - Recipient unclear: Generate with [NAME] placeholder, then ask "Who is the recipient?"
   - Action items ambiguous: Include all plausible items with [OWNER] placeholders, then ask for confirmation
   - Transcript incomplete: Generate draft immediately, note limitations, offer to regenerate with more context

   Include explicit "NEVER block generation" statements.

3. **Update description in frontmatter** to include new capabilities:
   - Add "Handles incomplete transcripts gracefully" to description

4. **Update "## Your Task" section** to reference new activation logic:
   - Step 0: Check activation (is this a clear invocation?)
   - Keep existing steps 1-3 (Extract, Generate, Ask if unclear)

Do NOT modify the extraction schema, formatting rules, anti-hallucination rules, examples, or signature configuration sections - those remain unchanged.

Reference RESEARCH.md "Example 2: Intent Detection" and "Example 3: Ask-Then-Generate Protocol" for exact XML structure patterns.
  </action>
  <verify>
Read SKILL.md and confirm:
- `<activation_detection>` section exists with three-tier logic
- `<clarification_protocol>` section exists with ask-then-generate pattern
- Description includes "incomplete transcripts"
- "## Your Task" references activation check
  </verify>
  <done>
SKILL.md contains activation detection with clear/ambiguous/none tiers, clarification protocol that never blocks generation, and updated task flow referencing activation logic
  </done>
</task>

<task type="auto">
  <name>Task 2: Update edge cases section with Phase 2 handling</name>
  <files>SKILL.md</files>
  <action>
Enhance the existing "## Edge Cases" section in SKILL.md to handle Phase 2 scenarios:

1. **Add "Very Short Transcripts" edge case:**
   - IF transcript is very brief (< 5 exchanges):
   - Extract available information
   - Use "Based on our brief conversation..." in email opening
   - Still generate full email structure

2. **Add "Speaker Labels Without Names" edge case:**
   - IF transcript shows "Speaker 1", "Speaker 2" instead of names:
   - Extract content anyway
   - Ask user: "Can you tell me who the participants were?"
   - Use [NAME] placeholders until clarified

3. **Keep existing edge cases** (Multiple Recipients, No Clear Action Items, Attachments Mentioned, Long Transcripts, Unclear Recipient) - no changes needed

4. **Add cross-reference to clarification_protocol:**
   - Add note at top of Edge Cases: "See `<clarification_protocol>` for how to handle questions about missing information"

Maintain the existing formatting style (### headers, bullet points, examples).
  </action>
  <verify>
Read SKILL.md "## Edge Cases" section and confirm:
- "Very Short Transcripts" subsection exists
- "Speaker Labels Without Names" subsection exists
- Cross-reference to clarification_protocol present
- Existing edge cases preserved
  </verify>
  <done>
Edge cases section includes handling for very short transcripts and speaker labels without names, with cross-reference to clarification protocol
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Read full SKILL.md and confirm structure is coherent
2. Verify new sections use XML tags properly (opening and closing)
3. Confirm no existing functionality was removed or broken
4. Verify the skill file is well-formed markdown
</verification>

<success_criteria>
- SKILL.md has `<activation_detection>` section with three-tier decision logic
- SKILL.md has `<clarification_protocol>` section with ask-then-generate pattern
- Edge cases include very short transcripts and speaker labels without names
- Description updated to reflect new capabilities
- Task flow references activation check
- All existing Phase 1 content preserved (examples, extraction schema, formatting rules)
</success_criteria>

<output>
After completion, create `.planning/phases/02-robust-handling/02-01-SUMMARY.md`
</output>
